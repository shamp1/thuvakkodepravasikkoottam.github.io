<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-24113850-2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-24113850-2");
    </script>

    <title>Thuvakkode Pravasikkoottam</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@100;200;300;400&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Chewy&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Caveat&display=swap"
      rel="stylesheet"
    />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://www.amcharts.com/lib/4/core.js"></script>
    <script src="https://www.amcharts.com/lib/4/charts.js"></script>
    <script src="https://www.amcharts.com/lib/4/themes/animated.js"></script>
    <style>
      body {
        font: 20px Montserrat, sans-serif;
        line-height: 1.8;
        color: #f5f6f7;
      }

      p {
        font-size: 16px;
      }

      .margin {
        margin-bottom: 45px;
      }

      .bg-1 {
        background-color: #1abc9c;
        /* Green */
        color: #ffffff;
      }

      .bg-2 {
        background-color: #474e5d;
        /* Dark Blue */
        color: #ffffff;
      }

      .bg-3 {
        background-color: #ffffff;
        /* White */
        color: #555555;
      }

      .bg-4 {
        background-color: #2f2f2f;
        /* Black Gray */
        color: #fff;
      }

      .container-fluid {
        padding-top: 70px;
        padding-bottom: 70px;
      }

      .navbar {
        padding-top: 15px;
        padding-bottom: 15px;
        border: 0;
        border-radius: 0;
        margin-bottom: 0;
        font-size: 12px;
        letter-spacing: 5px;
      }

      .navbar-nav li a:hover {
        color: #1abc9c !important;
      }
      .navbar-nav {
        font-family: "Barlow Condensed", sans-serif;
      }
      .tile {
        width: 300px;
        height: 425px;
        background-color: #cccccc;
        border-radius: 5px;
        overflow: hidden;
        display: inline-block;
        margin-bottom: 20px;
      }

      .photo-holder {
        width: 100%;
        height: 350px;
        background-color: #cccccc;
        overflow: hidden;
      }

      .photo-holder img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .name-text,
      .house-text,
      .country-text-holder {
        font-family: "Barlow Condensed", sans-serif;
      }

      .house-text {
        font-weight: 300;
      }

      .country-text {
        font-weight: 200;
        font-size: 17px;
        margin-right: 5px;
      }

      .tile-text-holder {
        padding: 14px;
        position: relative;
      }

      .tile-text-holder p {
        line-height: 40%;
        color: #000000;
      }

      .country-text-holder {
        line-height: 25%;
        color: #000000;
      }

      .tile-holder {
        width: 95%;
        margin: 0 auto;
        display: flex;
        flex-direction: row;
        flex-wrap: wrap;
        justify-content: space-around;
        padding-top: 40px;
      }

      .header-holder {
        background-color: #cccccc;
      }

      .heading {
        font-family: "Chewy", cursive;

        color: #000;
        font-size: 17px;
        line-height: 25px;
        margin-left: 20px;
      }

      .here-we-are-title,
      .here-is-our-blood {
        color: #000000;
        text-align: center;
        font-family: "Caveat", cursive;
        margin-top: 20px;
        font-size: 24px;
      }

      .menu-items {
        font-family: "Barlow Condensed", sans-serif;
      }

      .blood-holder {
        color: #000000;

        width: 95%;
        margin: 0 auto;
        padding-top: 20px;
      }

      .blood-group-header {
        background-color: #ffb466;
        margin-top: 5px;
      }

      .blood-group-name-tile {
        background-color: #cccccc;
        margin-top: 5px;
      }

      .blood-tile {
        border-radius: 5px;
        font-family: "Barlow Condensed", sans-serif;
        padding-left: 10px;
        font-size: 16px;
      }

      .footer {
        height: 50px;
        background-color: #cccccc;
        display: none;
      }

      .sl-number {
        background-color: #bbb8b8;
        padding: 8px;
        font-size: 12px;
        border-radius: 2px;
        position: absolute;
        right: 14px;
        bottom: 13px;
      }

      .footer-text {
        padding-top: 10px;
        text-align: center;
        font-family: "Barlow Condensed", sans-serif;
        font-size: 16px;
        color: #000000;
      }

      .here-we-are-title,
      .here-is-our-blood {
        display: none;
      }

      #chartdiv {
        width: 100%;
        height: 600px;
      }
    </style>
  </head>

  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-default header-holder">
      <div class="container">
        <div class="navbar-header">
          <button
            type="button"
            class="navbar-toggle"
            data-toggle="collapse"
            data-target="#myNavbar"
          >
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <div class="heading">Thuvakkode<br />Pravasikkoottam</div>
        </div>
        <div class="collapse navbar-collapse" id="myNavbar">
          <ul class="nav navbar-nav navbar-right menu-items">
            <li><a href="#" onclick="showPhotoPage()">WE</a></li>
            <li><a href="#" onclick="showBloodPage()">OUR BLOOD</a></li>
            <li><a href="#" onclick="showPresencePage()">OUR PRESENCE</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- First Container -->
    <!--<div class="here-we-are-title">here we are...</div>
    <div class="here-is-our-blood">here is our blood...</div>--->

    <div class="tile-holder"></div>
    <div class="blood-holder"></div>
    <div class="presence-holder"><div id="chartdiv"></div></div>
    <!-- Footer -->
    <footer class="footer">
      <div class="footer-text">Â© All rights reserved</div>
    </footer>
    <!-- Footer -->

    <script>
      var jsonData = "";
      var stringData = "";
      var countryCodes = {
        Bahrain: "bh",
        India: "in",
        Kuwait: "kw",
        Norway: "no",
        Oman: "om",
        Qatar: "qa",
        "Saudi Arabia": "sa",
        Sweden: "se",
        "United Arab Emirates": "ae",

        "United Kingdom": "gb",

        USA: "us",
      };

      var bloodMaster = [
        "A +ve",
        "A -ve",
        "B +ve",
        "B -ve",
        "O +ve",
        "O -ve",
        "AB +ve",
        "AB -ve",
      ];

      function showPhotoPage() {
        $(".navbar-collapse").collapse("hide");
        // $(".here-we-are-title").show();
        // $(".here-is-our-blood").hide();
        $(".tile-holder").show();
        $(".blood-holder").hide();
        $(".presence-holder").hide();
      }

      function showBloodPage() {
        var dimensionValue = "visited_blood_page";
        ga("set", "dimension1", dimensionValue);

        $(".navbar-collapse").collapse("hide");
        // $(".here-we-are-title").hide();
        // $(".here-is-our-blood").show();
        $(".tile-holder").hide();
        $(".blood-holder").show();
        $(".presence-holder").hide();
      }

      function showPresencePage() {
        var dimensionValue = "visited_presence_page";
        ga("set", "dimension2", dimensionValue);

        $(".navbar-collapse").collapse("hide");
        // $(".here-we-are-title").hide();
        // $(".here-is-our-blood").show();
        $(".tile-holder").hide();
        $(".blood-holder").hide();
        $(".presence-holder").show();
      }

      function renderBloodPage() {
        var bloofiltered = "";

        for (var i = 0; i < bloodMaster.length; i++) {
          $(".blood-holder").append(
            `<div class="blood-tile blood-group-header"> ${bloodMaster[i]}</div>`
          );

          for (var j = 0; j < jsonData.length; j++) {
            if (jsonData[j].blood == bloodMaster[i]) {
              $(".blood-holder").append(
                `<div class="blood-tile blood-group-name-tile"> ${jsonData[j].full_name}</div>`
              );
            }
          }
        }
      }

      function populateStringData() {
        stringData = jsonData.map(function (d, idx) {
          return `<div class="tile"> <div class="photo-holder"> <img src="https://drive.google.com/uc?${getIdFromGDriveURL(
            d.photo
          )}" /> </div> <div class="tile-text-holder"> <p class="name-text">${d.full_name} </p> <p class="house-text">${d.house_name}</p> <div class="country-text-holder"> <span class="country-text">${d.country}</span><span><img src="https://flagcdn.com/w20/${countryCodes[d.country]}.png" alt="" /></span><span class="sl-number">${++idx}</span><span></span> </div> </div> </div>`;
        });
      }

      function renderElements() {
        $(".tile-holder").html(stringData.join(""));
      }

      function titleCase(str) {
        str = str.toLowerCase();
        str = str.split(" ");

        for (var i = 0; i < str.length; i++) {
          str[i] = str[i].charAt(0).toUpperCase() + str[i].slice(1);
        }

        return str.join(" ");
      }

      function getProperCountryName(c) {
        c = c.toLowerCase();
        if (c == "dubai" || c == "uae" || c == "abudhabi uae") {
          return "United Arab Emirates";
        } else if (c == "ksa") {
          return "Saudi Arabia";
        } else {
          return titleCase(c);
        }
      }

      function formatKeys() {
        var dataString = JSON.stringify(jsonData);
        dataString = dataString.replace(/Full Name/g, "full_name");
        dataString = dataString.replace(/House Name/g, "house_name");
        dataString = dataString.replace(/Current Contact Number/g, "mob");
        dataString = dataString.replace(/Date of Birth/g, "dob");
        dataString = dataString.replace(/Upload a close up photo/g, "photo");
        dataString = dataString.replace(/Blood group/g, "blood");
        dataString = dataString.replace(
          /Currently working country/g,
          "country"
        );

        jsonData = JSON.parse(dataString);
      }

      function formatData() {
        for (var i = 0; i < jsonData.length; i++) {
          jsonData[i].country = getProperCountryName(jsonData[i].country);
          jsonData[i].full_name = titleCase(jsonData[i].full_name);
          jsonData[i].house_name = titleCase(jsonData[i].house_name);
          jsonData[i].country = String(jsonData[i].country).trim();
          jsonData[i].mob = "#####";
          jsonData[i].dob = "#####";
        }
        //console.log(JSON.stringify(jsonData));
      }

      function shuffle(arr) {
        arr.sort(() => Math.random() - 0.5);
        return arr;
      }

      function renderChart() {
        am4core.useTheme(am4themes_animated);

        // Themes end

        //var chart = am4core.create("chartdiv", am4charts.PieChart3D);
        var chart = am4core.create("chartdiv", am4charts.PieChart);
        chart.data = getChartData();
        var pieSeries = chart.series.push(new am4charts.PieSeries());
        pieSeries.dataFields.value = "count";
        pieSeries.dataFields.category = "country";
        pieSeries.innerRadius = am4core.percent(50);
        pieSeries.ticks.template.disabled = true;
        pieSeries.labels.template.disabled = true;

        var rgm = new am4core.RadialGradientModifier();
        rgm.brightnesses.push(-0.8, -0.8, -0.5, 0, -0.5);
        pieSeries.slices.template.fillModifier = rgm;
        pieSeries.slices.template.strokeModifier = rgm;
        pieSeries.slices.template.strokeOpacity = 0.4;
        pieSeries.slices.template.strokeWidth = 0;

        chart.legend = new am4charts.Legend();
        chart.legend.position = "bottom";
        chart.legend.maxWidth = undefined;
      }

      function getChartData() {
        console.log("inside render presence chart function");
        console.log(countryCodes);
        var chartData = [];
        var temp;
        for (key in countryCodes) {
          temp = new Object();
          temp.country = key;
          temp.count = jsonData.filter(function (d) {
            return d.country == key;
          }).length;
          if (temp.count > 0) {
            chartData.push(temp);
          }
        }
        return chartData;
      }

      function dataLoaded() {
        formatKeys();
        formatData();
        jsonData = shuffle(jsonData);
        populateStringData();
        renderElements();
        showPhotoPage();
        renderBloodPage();
        renderChart();
      }

      function loadJSON() {
        $.ajax({
          url:
            "https://raw.githubusercontent.com/thuvakkodepravasikkoottam/thuvakkodepravasikkoottam.github.io/master/test.json",
          dataType: "text",
          success: function (data) {
            jsonData = JSON.parse(data).data;
            // console.log(jsonData);
            // console.log(typeof jsonData);
            dataLoaded();
          },
          error: function (jqXHR, exception) {
            console.log(jqXHR);
            console.log(exception);
          },
        });
      }

      function getIdFromGDriveURL(p) {
        return p.substring(p.indexOf("id="));
      }

      function testDataLoad() {
        jsonData = {
          data: [
            {
              Timestamp: "2020/05/02 11:52:01 AM GMT+2",
              "Full Name": "Sarath Mohan",
              "House Name": "Archana",
              "Currently working country": "Oman",
              "Current Contact Number": "+96891271371",
              "Date of Birth": "1989-01-27",
              "Blood group": "B +ve",
              "Upload a close up photo":
                "https://drive.google.com/u/0/open?usp=forms_web&id=1QkjImD40Sl9sATzTh2yA4gn4U5vAqKAP",
            },
          ],
        };

        dataLoaded();
      }

      $(document).ready(function () {
        showPhotoPage();
        loadJSON();
        $(".footer").show();
        //testDataLoad();
      });
    </script>
  </body>
</html>
